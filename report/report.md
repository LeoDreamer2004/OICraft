# Java程序设计期末作业——OICraft

## 项目简介

SpringBoot是一个基于Spring的轻量级框架，它可以用来快速开发基于Java的Web应用程序。

~~由于长期苦于Openjudge和编程网格的网页界面~~，本次课程设计作业依托于 SpringBoot 架构开发了一款在线代码测评网站——OICraft。

---

## 项目分工

- 原梓轩 2200010825：前端交互页面以及 MVC 框架搭建
- 陈润璘 2200010848：SQL 数据库的设计与 JDBA 实现
- 任子博 2200010626：业务逻辑与后端代码编写

---

## 使用方法

OICraft 所用服务器是 SpringBoot 内置的 Tomcat 服务器（在本机运行），数据库 MySQL 来自于远程的阿里云服务器，采用了 JPA 框架来操作数据库。前端页面采用了 Thymeleaf 模板引擎。

- 下载项目源代码后，使用 IntelliJ IDEA 作为项目打开。
- 点击 `pom.xml` 文件，刷新导入 Maven 依赖。
- 在 `resources/application.properties` 文件中配置数据库连接信息和邮箱信息。这里我们已经配好了远程阿里云数据库和公用邮箱。
- 运行 `OICraftApplication.java` 启动项目。如果控制台出现了 OICraft 的 Logo，并随后出现了 SpringBoot 的运行日志 `Completed initialization in xxx ms`，说明项目启动成功。
- 在浏览器中输入 `http://localhost:8080` 即可访问网站。

本项目已在 [GitHub](https://github.com/LeoDreamer2004/OICraft) 上开源。

---

## 基本功能

### 代码评测

本项目是一个在线代码测评网站，用户可以在网站上提交代码，网站会自动编译运行代码，并返回运行结果。目前支持的语言有Java、C、C++、Python（实际上，这里的代码是在本机运行的，所以本机需要有相应的编译器和开发环境）。

### 用户管理

<img src="./img/profile.png" alt="个人档案实例">

依托于 SpringSecurity 框架，本项目实现了用户的注册、登录、登出功能。用户可以在网站上注册账号，登录后可以提交代码，查看提交记录等。对于某些网页，需要登录后才能访问。

我们设置了管理员系统。管理员可以任意编辑问题，查看用户提交记录等。同时，我们还提供了站点管理的操作页面。管理员可以编辑其他用户的权限，或者对用户进行删除。

我们还将用户根据积分分成了若干用户组。从低到高依次为 `BEGINNER`, `INTERMEDIATE`, `ADVANCED`, `EXPERT`。积分可以通过每日的签到系统获得，也可以通过提交代码获得。不同用户组的用户名称会被着以不同的颜色。

我们还设置了绑定邮箱的功能。用户可以绑定邮箱，绑定邮箱后可以通过邮箱找回密码。通过使用一个公共邮箱，生成一个 UUID 验证码，发送到用户的邮箱，用户输入验证码即可完成验证或者找回密码。

### 问题管理

在题目列表中陈列着数据库当中所有的问题。我们提供了问题搜索功能，用户可以通过关键字搜索问题。

任何已登录用户都可以上传问题，但只有出题者或管理员可以在网站上编辑和删除问题。问题的内容包括题目描述、输入输出样例、题目难度等。用户可以在网站上查看问题，提交代码，查看提交记录。

> 注：我们对网页端渲染提供了 markdown 和相应的 KaTeX 支持，用户可以在题目描述中使用 markdown 语法。允许用户下载题目的 markdown 版本。

关于编辑测试点，我们提供了两种方式。用户可以在网站上上传测试点文件，也可以手动输入测试点。我们还提供了测试点的下载功能，以满足备份等等的需要。文件的具体格式在网页上有详细说明。

---

## 项目结构

<img src="./img/structure.jpg" alt="项目结构图">

从整体上，项目大致分为五个主要层次：

- **Model**：模型层，用于定义数据结构，与数据库中的表一一对应。
- **DAO**：数据访问层，是对 SQL 语言的包装，这里用 JPA 对数据进行增删改查，直接与数据库交互。
- **Service**：服务层，用于处理业务逻辑，例如测试代码。调用 DAO 层处理数据，并返回结果给 Controller。
- **Controller**：控制层，是 MVC 架构的重点。用于处理用户请求，调用 Service 和 DAO 层处理业务逻辑，并返回结果给用户。此外，还有拦截器 Interceptor 用于拦截请求捕获必要的信息。
- **View**：前端页面，包括 HTML、CSS、JavaScript 等文件，依托于 bootstrap 样式和 Thymeleaf 模板引擎，给用户展示页面并直接与用户交互。

Spring架构提供的Bean容器，可以自动扫描并加载这些层次的类，实现了解耦合，提高了代码的可维护性。

---

## 代码实现

既然结构已经分析好了，接下来自内向外分析一下代码实现的一些细节。

### 数据库设计（Model层）

我们设计了五个重要的模型：

- **用户(User)**：用户的信息。同时实现 `UserDetails` 接口，用于 SpringSecurity 的用户认证。
- **题目(Problem)**：一个题目的信息。包括题目描述、输入输出样例、题目难度等。
- **提交(Submission)**：用户提交的代码。包括提交的代码、针对的问题、结果等。
- **输入输出对(IOpair)**：一个依赖于题目和提交的弱实体。包括输入输出样例、得分等。
- **测试点(Checkpoint)**：实际上是输入输出对-提交之间的多对多联系。

每个模型在数据库都有对应的表，表之间通过外键联系。这样，我们就可以通过 JPA 框架来操作数据库。
